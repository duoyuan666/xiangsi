<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡ˆæŸ¥é‡å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .description {
            font-size: 1.1rem;
            color: #718096;
            margin-bottom: 10px;
        }
        
        .features {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .feature {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        .feature-icon {
            font-size: 1.2rem;
        }
        
        .text-management {
            margin-bottom: 30px;
        }
        
        .management-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .management-title {
            font-size: 1.4rem;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .management-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }
        
        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        .text-areas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .text-box {
            position: relative;
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .text-box.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .text-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
        }
        
        .text-box-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .text-box-controls {
            display: flex;
            gap: 8px;
        }
        
        .icon-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .icon-btn.select {
            background: #e6f3ff;
            color: #0066cc;
        }
        
        .icon-btn.select:hover {
            background: #d1e9ff;
        }
        
        .icon-btn.select.active {
            background: #667eea;
            color: white;
        }
        
        .icon-btn.delete {
            background: #ffe6e6;
            color: #cc0000;
        }
        
        .icon-btn.delete:hover {
            background: #ffcccc;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 16px;
            border: none;
            border-radius: 0 0 10px 10px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            background: white;
        }
        
        textarea::placeholder {
            color: #a0aec0;
        }
        
        .char-count {
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 12px;
            color: #718096;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .comparison-section {
            margin-bottom: 30px;
        }
        
        .comparison-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .comparison-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .comparison-label {
            font-weight: 600;
            color: #4a5568;
        }
        
        select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .vs-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .detect-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .detect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .detect-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            border-top: 2px solid #e2e8f0;
            padding-top: 30px;
        }
        
        .summary {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }
        
        .similarity-text {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .similarity-score {
            font-size: 3rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .similarity-desc {
            font-size: 1rem;
            color: #718096;
            margin-top: 10px;
        }
        
        .result-section h2 {
            font-size: 1.4rem;
            color: #2d3748;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #highlighted-output {
            background: white;
            padding: 24px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            min-height: 120px;
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        
        #highlighted-output.empty {
            color: #a0aec0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        mark {
            background: linear-gradient(120deg, #ffd89b 0%, #19547b 100%);
            background-size: 100% 40%;
            background-repeat: no-repeat;
            background-position: 0 100%;
            color: #2d3748;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #718096;
            font-size: 0.9rem;
        }
        
        .algorithm-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .container {
            animation: slideInUp 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .text-box {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .detect-btn.loading::after {
            content: "";
            width: 16px;
            height: 16px;
            margin-left: 10px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .management-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .comparison-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .text-areas {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ æ–‡æ¡ˆæŸ¥é‡å·¥å…·</h1>
            <p class="description">æ™ºèƒ½æ£€æµ‹æ–‡æ¡ˆé‡å¤åº¦ï¼Œæ”¯æŒå¤šæ–‡æ¡ˆå¯¹æ¯”ï¼Œå¸®åŠ©åˆ›ä½œè€…é¿å…å†…å®¹é›·åŒ</p>
            <div class="features">
                <div class="feature">
                    <span class="feature-icon">ğŸ”’</span>
                    <span>æœ¬åœ°å¤„ç†ï¼Œéšç§å®‰å…¨</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âš¡</span>
                    <span>å³æ—¶æ£€æµ‹ï¼Œå¿«é€Ÿé«˜æ•ˆ</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ¯</span>
                    <span>ç²¾å‡†ç®—æ³•ï¼Œå¯é ç»“æœ</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ“Š</span>
                    <span>å¤šæ–‡æ¡ˆå¯¹æ¯”ï¼Œçµæ´»é€‰æ‹©</span>
                </div>
            </div>
        </div>

        <div class="text-management">
            <div class="management-controls">
                <div class="management-title">
                    <span>ğŸ“„</span>
                    <span>æ–‡æ¡ˆç®¡ç†</span>
                </div>
                <div class="management-buttons">
                    <button class="btn btn-primary" onclick="addTextBox()">
                        <span>â•</span>
                        <span>æ·»åŠ æ–‡æ¡ˆ</span>
                    </button>
                    <button class="btn btn-danger" onclick="clearAllTexts()">
                        <span>ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºæ‰€æœ‰</span>
                    </button>
                </div>
            </div>
            
            <div class="text-areas" id="text-areas">
                <div class="text-box" data-id="1">
                    <div class="text-box-header">
                        <div class="text-box-title">
                            <span>ğŸ“–</span>
                            <span>æ–‡æ¡ˆ 1</span>
                        </div>
                        <div class="text-box-controls">
                            <button class="icon-btn select" onclick="toggleSelection(1)" title="é€‰æ‹©æ­¤æ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”">
                                <span>âœ“</span>
                            </button>
                            <button class="icon-btn delete" onclick="deleteTextBox(1)" title="åˆ é™¤æ­¤æ–‡æ¡ˆ">
                                <span>âœ•</span>
                            </button>
                        </div>
                    </div>
                    <textarea placeholder="è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ–‡æ¡ˆå†…å®¹..." oninput="updateCharCount(1)"></textarea>
                    <div class="char-count" id="char-count-1">0 å­—</div>
                </div>
                
                <div class="text-box" data-id="2">
                    <div class="text-box-header">
                        <div class="text-box-title">
                            <span>âœï¸</span>
                            <span>æ–‡æ¡ˆ 2</span>
                        </div>
                        <div class="text-box-controls">
                            <button class="icon-btn select" onclick="toggleSelection(2)" title="é€‰æ‹©æ­¤æ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”">
                                <span>âœ“</span>
                            </button>
                            <button class="icon-btn delete" onclick="deleteTextBox(2)" title="åˆ é™¤æ­¤æ–‡æ¡ˆ">
                                <span>âœ•</span>
                            </button>
                        </div>
                    </div>
                    <textarea placeholder="è¯·è¾“å…¥ç¬¬äºŒä¸ªæ–‡æ¡ˆå†…å®¹..." oninput="updateCharCount(2)"></textarea>
                    <div class="char-count" id="char-count-2">0 å­—</div>
                </div>
            </div>
        </div>

        <div class="comparison-section">
            <div class="comparison-controls">
                <div class="comparison-selector">
                    <span class="comparison-label">å¯¹æ¯”ï¼š</span>
                    <select id="text-select-1">
                        <option value="">é€‰æ‹©æ–‡æ¡ˆ A</option>
                    </select>
                </div>
                
                <div class="vs-text">VS</div>
                
                <div class="comparison-selector">
                    <select id="text-select-2">
                        <option value="">é€‰æ‹©æ–‡æ¡ˆ B</option>
                    </select>
                    <span class="comparison-label">ï¼šå¯¹æ¯”</span>
                </div>
                
                <button class="detect-btn" onclick="compareTexts()" id="compare-btn" disabled>
                    ğŸš€ å¼€å§‹æ£€æµ‹
                </button>
            </div>
        </div>

        <div class="results">
            <div class="summary">
                <div class="similarity-text">æ–‡æ¡ˆé‡å¤åº¦</div>
                <div class="similarity-score"><span id="similarity-score">0.00</span>%</div>
                <div class="similarity-desc" id="similarity-desc">è¯·é€‰æ‹©ä¸¤ä¸ªæ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”</div>
            </div>
            
            <div class="result-section">
                <h2>ğŸ” æ£€æµ‹ç»“æœ</h2>
                <div id="highlighted-output" class="empty">è¿™é‡Œå°†æ˜¾ç¤ºå¯¹æ¯”ç»“æœï¼Œé‡å¤éƒ¨åˆ†ä¼šè¢«é«˜äº®æ ‡è®°</div>
            </div>
        </div>

        <footer>
            <div class="algorithm-info">
                <span>ğŸ”¬</span>
                <span>é‡‡ç”¨ N-gram å’Œ Jaccard ç›¸ä¼¼åº¦ç®—æ³•ï¼Œæ£€æµ‹ç»“æœä»…ä¾›å‚è€ƒ</span>
            </div>
        </footer>
    </div>

    <script>
        let textBoxCounter = 2;
        let selectedTexts = [];

        /**
         * æ·»åŠ æ–°çš„æ–‡æ¡ˆè¾“å…¥æ¡†
         */
        function addTextBox() {
            textBoxCounter++;
            const textAreas = document.getElementById('text-areas');
            
            const textBox = document.createElement('div');
            textBox.className = 'text-box';
            textBox.setAttribute('data-id', textBoxCounter);
            
            textBox.innerHTML = `
                <div class="text-box-header">
                    <div class="text-box-title">
                        <span>ğŸ“</span>
                        <span>æ–‡æ¡ˆ ${textBoxCounter}</span>
                    </div>
                    <div class="text-box-controls">
                        <button class="icon-btn select" onclick="toggleSelection(${textBoxCounter})" title="é€‰æ‹©æ­¤æ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”">
                            <span>âœ“</span>
                        </button>
                        <button class="icon-btn delete" onclick="deleteTextBox(${textBoxCounter})" title="åˆ é™¤æ­¤æ–‡æ¡ˆ">
                            <span>âœ•</span>
                        </button>
                    </div>
                </div>
                <textarea placeholder="è¯·è¾“å…¥æ–‡æ¡ˆå†…å®¹..." oninput="updateCharCount(${textBoxCounter})"></textarea>
                <div class="char-count" id="char-count-${textBoxCounter}">0 å­—</div>
            `;
            
            textAreas.appendChild(textBox);
            updateSelectors();
        }

        /**
         * åˆ é™¤æŒ‡å®šçš„æ–‡æ¡ˆè¾“å…¥æ¡†
         */
        function deleteTextBox(id) {
            const textBoxes = document.querySelectorAll('.text-box');
            if (textBoxes.length <= 2) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸¤ä¸ªæ–‡æ¡ˆè¾“å…¥æ¡†ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡æ¡ˆå—ï¼Ÿ')) {
                const textBox = document.querySelector(`[data-id="${id}"]`);
                if (textBox) {
                    textBox.remove();
                    // ç§»é™¤é€‰ä¸­çŠ¶æ€
                    selectedTexts = selectedTexts.filter(selectedId => selectedId !== id);
                    updateSelectors();
                    updateCompareButton();
                }
            }
        }

        /**
         * æ¸…ç©ºæ‰€æœ‰æ–‡æ¡ˆå†…å®¹
         */
        function clearAllTexts() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡æ¡ˆå†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                const textareas = document.querySelectorAll('textarea');
                textareas.forEach(textarea => {
                    textarea.value = '';
                });
                
                // æ›´æ–°å­—æ•°ç»Ÿè®¡
                const charCounts = document.querySelectorAll('.char-count');
                charCounts.forEach(charCount => {
                    charCount.textContent = '0 å­—';
                });
                
                // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                selectedTexts = [];
                const selectButtons = document.querySelectorAll('.icon-btn.select');
                selectButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // é‡ç½®ç»“æœæ˜¾ç¤º
                document.getElementById('similarity-score').textContent = '0.00';
                document.getElementById('similarity-desc').textContent = 'è¯·é€‰æ‹©ä¸¤ä¸ªæ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”';
                const output = document.getElementById('highlighted-output');
                output.innerHTML = 'è¿™é‡Œå°†æ˜¾ç¤ºå¯¹æ¯”ç»“æœï¼Œé‡å¤éƒ¨åˆ†ä¼šè¢«é«˜äº®æ ‡è®°';
                output.classList.add('empty');
                
                updateSelectors();
                updateCompareButton();
            }
        }

        /**
         * åˆ‡æ¢æ–‡æ¡ˆé€‰ä¸­çŠ¶æ€
         */
        function toggleSelection(id) {
            const button = document.querySelector(`[data-id="${id}"] .icon-btn.select`);
            const textBox = document.querySelector(`[data-id="${id}"]`);
            
            if (selectedTexts.includes(id)) {
                // å–æ¶ˆé€‰ä¸­
                selectedTexts = selectedTexts.filter(selectedId => selectedId !== id);
                button.classList.remove('active');
                textBox.classList.remove('selected');
            } else {
                // é€‰ä¸­
                if (selectedTexts.length >= 2) {
                    // å¦‚æœå·²ç»é€‰ä¸­äº†2ä¸ªï¼Œæ›¿æ¢æœ€æ—©é€‰ä¸­çš„
                    const oldId = selectedTexts.shift();
                    const oldButton = document.querySelector(`[data-id="${oldId}"] .icon-btn.select`);
                    const oldTextBox = document.querySelector(`[data-id="${oldId}"]`);
                    oldButton.classList.remove('active');
                    oldTextBox.classList.remove('selected');
                }
                selectedTexts.push(id);
                button.classList.add('active');
                textBox.classList.add('selected');
            }
            
            updateSelectors();
            updateCompareButton();
        }

        /**
         * æ›´æ–°ä¸‹æ‹‰é€‰æ‹©å™¨
         */
        function updateSelectors() {
            const select1 = document.getElementById('text-select-1');
            const select2 = document.getElementById('text-select-2');
            
            // ä¿å­˜å½“å‰é€‰æ‹©
            const currentValue1 = select1.value;
            const currentValue2 = select2.value;
            
            // æ¸…ç©ºé€‰é¡¹
            select1.innerHTML = '<option value="">é€‰æ‹©æ–‡æ¡ˆ A</option>';
            select2.innerHTML = '<option value="">é€‰æ‹©æ–‡æ¡ˆ B</option>';
            
            // æ·»åŠ æ‰€æœ‰æ–‡æ¡ˆé€‰é¡¹
            const textBoxes = document.querySelectorAll('.text-box');
            textBoxes.forEach(box => {
                const id = box.getAttribute('data-id');
                const title = box.querySelector('.text-box-title span:last-child').textContent;
                const option1 = new Option(title, id);
                const option2 = new Option(title, id);
                select1.appendChild(option1);
                select2.appendChild(option2);
            });
            
            // å¦‚æœæœ‰é€‰ä¸­çš„æ–‡æ¡ˆï¼Œè‡ªåŠ¨è®¾ç½®ä¸‹æ‹‰æ¡†
            if (selectedTexts.length >= 1) {
                select1.value = selectedTexts[0];
            } else if (currentValue1) {
                select1.value = currentValue1;
            }
            
            if (selectedTexts.length >= 2) {
                select2.value = selectedTexts[1];
            } else if (currentValue2) {
                select2.value = currentValue2;
            }
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            select1.onchange = select2.onchange = updateCompareButton;
        }

        /**
         * æ›´æ–°å¯¹æ¯”æŒ‰é’®çŠ¶æ€
         */
        function updateCompareButton() {
            const select1 = document.getElementById('text-select-1');
            const select2 = document.getElementById('text-select-2');
            const compareBtn = document.getElementById('compare-btn');
            
            const hasSelection = select1.value && select2.value && select1.value !== select2.value;
            compareBtn.disabled = !hasSelection;
        }

        /**
         * æ›´æ–°å­—æ•°ç»Ÿè®¡
         */
        function updateCharCount(id) {
            const textarea = document.querySelector(`[data-id="${id}"] textarea`);
            const charCount = document.getElementById(`char-count-${id}`);
            if (textarea && charCount) {
                const count = textarea.value.length;
                charCount.textContent = `${count} å­—`;
            }
        }

        /**
         * åˆ›å»ºæ–‡æœ¬çš„ n-gram é›†åˆ
         */
        function createNgrams(text, n) {
            const ngrams = new Set();
            const cleanedText = text.replace(/[^\p{L}\p{N}\s]/gu, '').replace(/\s+/g, ' ').trim();
            const chars = Array.from(cleanedText);

            if (chars.length < n) {
                return ngrams;
            }

            for (let i = 0; i <= chars.length - n; i++) {
                const ngram = chars.slice(i, i + n).join('');
                if (ngram.trim().length > 0) {
                    ngrams.add(ngram);
                }
            }
            return ngrams;
        }

        /**
         * è·å–ç›¸ä¼¼åº¦æè¿°
         */
        function getSimilarityDescription(similarity) {
            if (similarity >= 70) {
                return "é‡å¤åº¦è¾ƒé«˜ï¼Œå»ºè®®å¤§å¹…ä¿®æ”¹";
            } else if (similarity >= 40) {
                return "é‡å¤åº¦ä¸­ç­‰ï¼Œå»ºè®®é€‚å½“è°ƒæ•´";
            } else if (similarity >= 15) {
                return "é‡å¤åº¦è¾ƒä½ï¼Œå†…å®¹åŸºæœ¬åŸåˆ›";
            } else {
                return "é‡å¤åº¦å¾ˆä½ï¼Œå†…å®¹é«˜åº¦åŸåˆ›";
            }
        }

        /**
         * ä¸»å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸¤æ®µæ–‡æœ¬
         */
        function compareTexts() {
            const select1 = document.getElementById('text-select-1');
            const select2 = document.getElementById('text-select-2');
            
            if (!select1.value || !select2.value || select1.value === select2.value) {
                alert('è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„æ–‡æ¡ˆè¿›è¡Œå¯¹æ¯”ï¼');
                return;
            }
            
            const textarea1 = document.querySelector(`[data-id="${select1.value}"] textarea`);
            const textarea2 = document.querySelector(`[data-id="${select2.value}"] textarea`);
            
            const text1 = textarea1.value.trim();
            const text2 = textarea2.value.trim();
            
            if (!text1 || !text2) {
                alert('è¯·ç¡®ä¿ä¸¤ä¸ªæ–‡æ¡ˆéƒ½æœ‰å†…å®¹ï¼');
                return;
            }
            
            const button = document.getElementById('compare-btn');
            const similarityScoreEl = document.getElementById('similarity-score');
            const similarityDescEl = document.getElementById('similarity-desc');
            const highlightedOutputEl = document.getElementById('highlighted-output');

            // æ·»åŠ åŠ è½½çŠ¶æ€
            button.classList.add('loading');
            button.textContent = 'æ£€æµ‹ä¸­...';
            button.disabled = true;

            // æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
            setTimeout(() => {
                try {
                    const n = 2;
                    const ngrams1 = createNgrams(text1, n);
                    const ngrams2 = createNgrams(text2, n);
                    
                    const intersection = new Set([...ngrams1].filter(ngram => ngrams2.has(ngram)));
                    const unionSize = ngrams1.size + ngrams2.size - intersection.size;
                    const similarity = unionSize === 0 ? 0 : intersection.size / unionSize;
                    const similarityPercent = similarity * 100;
                    
                    // æ›´æ–°æ˜¾ç¤º
                    similarityScoreEl.textContent = similarityPercent.toFixed(2);
                    similarityDescEl.textContent = getSimilarityDescription(similarityPercent);
                    
                    // é«˜äº®æ˜¾ç¤ºé‡å¤éƒ¨åˆ†
                    let highlightedText = text2;
                    const sortedIntersection = Array.from(intersection).sort((a, b) => b.length - a.length);

                    sortedIntersection.forEach(ngram => {
                        const regex = new RegExp(escapeRegExp(ngram), 'g');
                        highlightedText = highlightedText.replace(regex, `<mark>${ngram}</mark>`);
                    });
                    
                    highlightedOutputEl.innerHTML = highlightedText;
                    highlightedOutputEl.classList.remove('empty');
                } catch (error) {
                    console.error('æ£€æµ‹è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error);
                    alert('æ£€æµ‹è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    button.classList.remove('loading');
                    button.textContent = 'ğŸš€ å¼€å§‹æ£€æµ‹';
                    updateCompareButton();
                }
            }, 500);
        }
        
        /**
         * è¾…åŠ©å‡½æ•°ï¼šè½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦
         */
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateSelectors();
            updateCompareButton();
            
            // åˆå§‹åŒ–å­—æ•°ç»Ÿè®¡
            updateCharCount(1);
            updateCharCount(2);
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                if (!document.getElementById('compare-btn').disabled) {
                    compareTexts();
                }
            }
            
            // Ctrl/Cmd + N æ·»åŠ æ–°æ–‡æ¡ˆ
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                addTextBox();
            }
            
            // Ctrl/Cmd + Shift + Delete æ¸…ç©ºæ‰€æœ‰
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'Delete') {
                e.preventDefault();
                clearAllTexts();
            }
        });
    </script>
</body>
</html>